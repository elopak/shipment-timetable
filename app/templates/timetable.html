<div *ngIf="error" class="alert alert-danger" role="alert">{{error}}</div>
{{selectedShipment&&selectedShipment.id}}
<table class="table table-bordered table-schedule">
    <tr>
        <td colspan="14">
            <div class="btn-toolbar" role="toolbar">
                <div class="btn-group" role="group">
                    <button
                            type="button"
                            class="btn btn-default"
                            (click)="dialogAddShipment.show()"
                            [disabled]="!isSelectedIntervalAvailable()">
                        <span class="glyphicon glyphicon-plus"></span> Добавить запись
                    </button>
                    <button
                            type="button"
                            class="btn btn-default"
                            [disabled]="!selectedShipment" (click)="removeSelectedShipment()">
                        <span class="glyphicon glyphicon-remove"></span> Удалить
                    </button>
                    <button type="button" class="btn btn-default" [disabled]="!selectedShipment">
                        <span class="glyphicon glyphicon-pencil"></span> Редактировать
                    </button>
                </div>
                <div class="btn-group input-group" role="group">
                    <span class="input-group-addon" id="basic-addon1">Неделя</span>
                    <button *ngFor="let week of weeks"
                            class="btn btn-default"
                            (click)="selectWeek(week)"
                            [ngClass]="{active:selectedWeek===week}">
                        <strong *ngIf="currentWeek===week">{{week}}</strong>
                        <span *ngIf="currentWeek!=week">{{week}}</span>
                    </button>
                </div>
            </div>
        </td>
    </tr>
    <tr class="info">
        <th rowspan="2">День</th>
        <th rowspan="2">Окно</th>
        <th rowspan="2">Клиент</th>
        <th rowspan="2">Экспедитор</th>
        <th colspan="2" class="hidden-xs">Кол-во паллет</th>
        <th rowspan="2" class="hidden-xs">Реализация</th>
        <th rowspan="2" class="hidden-xs">Машина</th>
        <th rowspan="2" class="hidden-xs">Водитель</th>
        <th rowspan="2" class="hidden-xs">Телефон</th>
        <th rowspan="2" class="visible-lg">Прибытие</th>
        <th rowspan="2">Отгрузка</th>
        <th rowspan="2" class="visible-lg">Комментарии</th>
    </tr>
    <tr class="info">
        <th class="hidden-xs">План</th>
        <th class="hidden-xs">Факт</th>
    </tr>
    <template ngFor #day let-day [ngForOf]="days">

        <template ngFor #interval let-interval [ngForOf]="day.intervals" *ngIf="!day.hasShipments()">
            <tr>
                <td [attr.rowspan]="day.getRows()"
                    *ngIf="interval.id==1">
                    <span class="visible-lg">{{day}}</span>
                    {{selectedWeek.getFormattedDate(day)}}
                </td>
                <td>{{interval}}</td>
                <td (click)="selectInterval(interval, day)" [ngClass]="{success:selectedInterval===interval}" colspan="12"></td>
            </tr>
        </template>

        <template ngFor #interval let-interval [ngForOf]="day.intervals" *ngIf="day.hasShipments()">
            <tr *ngFor="let shipment of interval.shipments">
                <td [attr.rowspan]="day.getRows()"
                    *ngIf="interval.id==1&&interval.shipments.indexOf(shipment)==0">
                    <span class="visible-lg">{{day.toString()}}</span>
                    {{selectedWeek.getFormattedDate(day)}}
                </td>
                <td [attr.rowspan]="interval.shipments.length"
                    *ngIf="interval.shipments.indexOf(shipment)==0">{{interval}}
                </td>
                <td class="active" (click)="selectShipment(shipment, interval, day)" [ngClass]="{success:selectedShipment===shipment}">
                    {{shipment.customer}}
                </td>
                <td class="active" (click)="selectShipment(shipment, interval, day)" [ngClass]="{success:selectedShipment===shipment}">
                    {{shipment.dispatcher}}
                </td>
                <td class="active hidden-xs" (click)="selectShipment(shipment, interval, day)" [ngClass]="{success:selectedShipment===shipment}">
                    {{shipment.plannedPallets}}
                </td>
                <td class="active hidden-xs" (click)="selectShipment(shipment, interval, day)" [ngClass]="{success:selectedShipment===shipment}">
                    {{shipment.actualPallets}}
                </td>
                <td class="active hidden-xs" (click)="selectShipment(shipment, interval, day)" [ngClass]="{success:selectedShipment===shipment}">
                    {{shipment.ticket}}
                </td>
                <td class="active hidden-xs" (click)="selectShipment(shipment, interval, day)" [ngClass]="{success:selectedShipment===shipment}">
                    {{shipment.vehicle}}
                </td>
                <td class="active hidden-xs" (click)="selectShipment(shipment, interval, day)" [ngClass]="{success:selectedShipment===shipment}">
                    {{shipment.driver}}
                </td>
                <td class="active hidden-xs" (click)="selectShipment(shipment, interval, day)" [ngClass]="{success:selectedShipment===shipment}">
                    {{shipment.telephone}}
                </td>
                <td class="active visible-lg" (click)="selectShipment(shipment, interval, day)" [ngClass]="{success:selectedShipment===shipment}">
                    {{shipment.arrived}}
                </td>
                <td class="active" (click)="selectShipment(shipment, interval, day)" [ngClass]="{success:selectedShipment===shipment}">
                    {{shipment.loaded}}
                </td>
                <td class="active visible-lg" (click)="selectShipment(shipment, interval, day)" [ngClass]="{success:selectedShipment===shipment}">
                    {{shipment.comments}}
                </td>
            </tr>
            <tr *ngIf="!interval.hasShipments()">
                <td [attr.rowspan]="day.getRows()"
                    *ngIf="interval.id==1">
                    <span class="visible-lg">{{day}}</span>
                    {{selectedWeek.getFormattedDate(day)}}
                </td>
                <td>{{interval}}</td>
                <td (click)="selectInterval(interval, day)" [ngClass]="{success:selectedInterval===interval}" colspan="12"></td>
            </tr>
        </template>
    </template>
</table>
<div bsModal #dialogAddShipment="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" (click)="dialogAddShipment.hide()" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">Добавить запись</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="new-customer">Клиент</label>
                        <select class="form-control" id="new-customer" [(ngModel)]="newShipment.customer.id">
                            <option *ngFor="let customer of customers" [value]="customer.id">{{customer}}</option>
                        </select>

                        <label for="new-dispatcher">Экспедитор</label>
                        <select class="form-control" id="new-dispatcher" [(ngModel)]="newShipment.dispatcher.id">
                            <option *ngFor="let dispatcher of dispatchers" [value]="dispatcher.id">{{dispatcher}}</option>
                        </select>

                        <label for="new-pallets">Количество паллет</label>
                        <select class="form-control" id="new-pallets" [(ngModel)]="newShipment.plannedPallets">
                            <option *ngFor="let n of availablePallets" [value]="n">{{n}}</option>
                        </select>

                        <label for="new-vehicle">Машина</label>
                        <input class="form-control" id="new-vehicle" [(ngModel)]="newShipment.vehicle"/>

                        <label for="new-driver">ФИО водителя</label>
                        <input class="form-control" id="new-driver" [(ngModel)]="newShipment.driver"/>

                        <label for="new-telephone">Телефон для связи</label>
                        <input class="form-control" id="new-telephone" [(ngModel)]="newShipment.telephone" (blur)="validate()" (keyup)="validate()" />
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" (click)="dialogAddShipment.hide()" class="btn btn-default">Отмена</button>
                <button type="submit" (click)="saveShipment();dialogAddShipment.hide()" class="btn btn-default">Добавить</button>
            </div>
        </div>
    </div>
</div>

